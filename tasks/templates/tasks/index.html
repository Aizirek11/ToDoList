{% load static %}
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
h1 { text-align: center; color: #333; }
.hidden { display: none; }
.form-group { margin-bottom: 15px; }
input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px; }
button { padding: 10px 20px; border: none; border-radius: 8px; background: #6366f1; color: white; cursor: pointer; transition: background 0.2s; }
button:hover { background: #4f46e5; }
.board { display: flex; gap: 20px; margin-top: 20px; }
.column { flex: 1; background: #e2e8f0; padding: 10px; border-radius: 12px; min-height: 300px; }
.column h2 { text-align: center; margin-bottom: 10px; }
.task-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; margin-bottom: 10px; }
.task-title { font-weight: 600; margin-bottom: 6px; }
.task-desc { font-size: 14px; color: #555; margin-bottom: 6px; }
.task-deadline { font-size: 12px; color: #999; margin-bottom: 6px; }
.status { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; color: white; margin-bottom: 6px; }
.todo { background: #f59e0b; }
.in-progress { background: #3b82f6; }
.done { background: #10b981; }
.arrow-btn { position: absolute; bottom: 10px; right: 10px; background: #6366f1; border: none; color: white; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.arrow-btn.disabled { background: #ccc; cursor: not-allowed; }
/* МАЛЕНЬКАЯ КНОПКА Delete как статус */
.delete-btn { border: none; color: white; border-radius: 12px; padding: 2px 8px; cursor: pointer; font-weight: 600; font-size: 12px; transition: background 0.2s; display: inline-block; margin-top: 6px; background: #ef4444; }
.delete-btn:hover { background: #dc2626; }
.welcome { text-align: center; margin-bottom: 20px; }
.new-task { display: flex; gap: 10px; margin-bottom: 20px; }
.new-task input { flex: 1; }
.logout-btn { margin-left: 10px; background: #ef4444; }
.logout-btn:hover { background: #dc2626; }
.filters { display: flex; gap: 10px; margin-bottom: 20px; }
.pagination { display: flex; justify-content: space-between; margin-top: 20px; }
</style>
</head>
<body>
<div class="container">
<h1>Task Manager</h1>

<div id="authScreen">
    <h2>Регистрация / Вход</h2>
    <div class="form-group"><input type="text" id="username" placeholder="Имя пользователя"></div>
    <div class="form-group"><input type="email" id="email" placeholder="Email"></div>
    <div class="form-group"><input type="password" id="password" placeholder="Пароль"></div>
    <div class="form-group"><input type="password" id="passwordConfirm" placeholder="Подтвердите пароль"></div>
    <button id="registerBtn">Зарегистрироваться</button>
    <button id="loginBtn">Войти</button>
</div>

<div id="mainScreen" class="hidden">
    <div class="welcome">Добро пожаловать, <span id="currentUser"></span>!
        <button id="logoutBtn" class="logout-btn">Выйти</button>
    </div>

    <div class="new-task">
        <input type="text" id="newTitle" placeholder="Название задачи">
        <input type="text" id="newDesc" placeholder="Описание задачи">
        <input type="date" id="newDeadline">
        <button id="addTaskBtn">Добавить</button>
    </div>

    <div class="filters">
        <select id="statusFilter">
            <option value="">Все статусы</option>
            <option value="todo">To Do</option>
            <option value="in_progress">In Progress</option>
            <option value="done">Done</option>
        </select>

        <input type="date" id="deadlineFilter" placeholder="Дедлайн до">
        <input type="text" id="searchInput" placeholder="Поиск по названию">
        <select id="sortSelect">
            <option value="desc">Сначала новые</option>
            <option value="asc">Сначала старые</option>
        </select>
    </div>

    <div class="board">
        <div class="column" id="todoColumn"><h2>To Do</h2></div>
        <div class="column" id="inProgressColumn"><h2>In Progress</h2></div>
        <div class="column" id="doneColumn"><h2>Done</h2></div>
    </div>

    <div class="pagination">
        <button id="prevPage">← Назад</button>
        <button id="nextPage">Вперёд →</button>
    </div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

let currentUser = null;
let users = [];
let tasks = [];
let currentPage = 1;
const TASKS_PER_PAGE = 3;

const statusClass = status => status==='todo'?'todo':status==='in_progress'?'in-progress':'done';
const formatStatus = status => status==='todo'?'To Do':status==='in_progress'?'In Progress':'Done';

function getFilteredTasks() {
    let filtered = tasks.filter(t => t.owner === currentUser);
    const statusVal = document.getElementById('statusFilter').value;
    if(statusVal) filtered = filtered.filter(t => t.status === statusVal);

    const deadlineVal = document.getElementById('deadlineFilter').value;
    if(deadlineVal) filtered = filtered.filter(t => t.deadline <= deadlineVal);

    const searchVal = document.getElementById('searchInput').value.trim().toLowerCase();
    if(searchVal) filtered = filtered.filter(t => t.title.toLowerCase().includes(searchVal));

    const sortVal = document.getElementById('sortSelect').value;
    if(sortVal==='asc') filtered.sort((a,b)=>new Date(a.created_at)-new Date(b.created_at));
    else filtered.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));

    return filtered;
}

function renderTasks(){
    const todoCol=document.getElementById('todoColumn');
    const inProgressCol=document.getElementById('inProgressColumn');
    const doneCol=document.getElementById('doneColumn');

    todoCol.innerHTML='<h2>To Do</h2>';
    inProgressCol.innerHTML='<h2>In Progress</h2>';
    doneCol.innerHTML='<h2>Done</h2>';

    const filtered = getFilteredTasks();
    const totalPages = Math.max(1, Math.ceil(filtered.length / TASKS_PER_PAGE));
    currentPage = Math.min(currentPage, totalPages);
    const start = (currentPage - 1) * TASKS_PER_PAGE;
    const pageTasks = filtered.slice(start, start + TASKS_PER_PAGE);

    pageTasks.forEach(task=>{
        const card=document.createElement('div');
        card.className='task-card';
        card.innerHTML=`
            <div class="task-title">${task.title}</div>
            <div class="task-desc">${task.description}</div>
            <div class="task-deadline">Deadline: ${task.deadline}</div>
            <div class="status ${statusClass(task.status)}">${formatStatus(task.status)}</div>
            <button class="arrow-btn ${task.status==='done'?'disabled':''}" data-id="${task.id}">&#8594;</button>
            <button class="delete-btn" data-id="${task.id}">Delete</button>
        `;
        if(task.status==='todo') todoCol.appendChild(card);
        else if(task.status==='in_progress') inProgressCol.appendChild(card);
        else doneCol.appendChild(card);
    });

    document.querySelectorAll('.arrow-btn:not(.disabled)').forEach(btn=>{
        btn.onclick=()=> {
            const id=parseInt(btn.getAttribute('data-id'));
            const task=tasks.find(t=>t.id===id);
            if(task.status==='todo') task.status='in_progress';
            else if(task.status==='in_progress') task.status='done';
            renderTasks();
        };
    });

    document.querySelectorAll('.delete-btn').forEach(btn=>{
        btn.onclick = () => {
            const id = parseInt(btn.getAttribute('data-id'));
            tasks = tasks.filter(t => t.id !== id);
            renderTasks();
        };
    });

    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage === totalPages;
}

// Регистрация
document.getElementById('registerBtn').onclick = () => {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const passwordConfirm = document.getElementById('passwordConfirm').value.trim();

    if(!username || !email || !password || !passwordConfirm) { alert('Все поля обязательны'); return; }
    if(users.some(u => u.email === email)) { alert('Email уже используется'); return; }
    if(password.length < 8) { alert('Пароль должен содержать минимум 8 символов'); return; }
    if(password !== passwordConfirm) { alert('Пароли не совпадают'); return; }

    users.push({ username, email, password });
    alert('Регистрация успешна! Теперь войдите.');
};

// Вход
document.getElementById('loginBtn').onclick=()=>{
    const email=document.getElementById('email').value.trim();
    const password=document.getElementById('password').value.trim();
    const user=users.find(u=>u.email===email && u.password===password);
    if(!user){ alert('Неверный email или пароль'); return; }
    currentUser=user.username;
    document.getElementById('currentUser').textContent=currentUser;
    document.getElementById('authScreen').classList.add('hidden');
    document.getElementById('mainScreen').classList.remove('hidden');
    renderTasks();
};

// Добавление задачи
document.getElementById('addTaskBtn').onclick=()=>{
    const title=document.getElementById('newTitle').value.trim();
    const desc=document.getElementById('newDesc').value.trim();
    const deadline=document.getElementById('newDeadline').value;
    if(!title||!desc||!deadline){ alert('Все поля задачи обязательны'); return; }

    const today = new Date(); today.setHours(0,0,0,0);
    if(new Date(deadline) < today){ alert('Дата выполнения не может быть в прошлом'); return; }

    const id=tasks.length?tasks[tasks.length-1].id+1:1;
    tasks.push({id,title,description:desc,status:'todo',deadline,owner:currentUser,created_at:new Date()});

    document.getElementById('newTitle').value='';
    document.getElementById('newDesc').value='';
    document.getElementById('newDeadline').value='';

    currentPage=1;
    renderTasks();
};

// Пагинация
document.getElementById('prevPage').onclick=()=>{ currentPage--; renderTasks(); };
document.getElementById('nextPage').onclick=()=>{ currentPage++; renderTasks(); };

// Выход
document.getElementById('logoutBtn').onclick=()=>{
    currentUser=null;
    document.getElementById('mainScreen').classList.add('hidden');
    document.getElementById('authScreen').classList.remove('hidden');
    document.getElementById('username').value='';
    document.getElementById('email').value='';
    document.getElementById('password').value='';
    document.getElementById('passwordConfirm').value='';
};

// Фильтры, поиск, сортировка
document.getElementById('statusFilter').onchange = renderTasks;
document.getElementById('deadlineFilter').onchange = renderTasks;
document.getElementById('searchInput').oninput = renderTasks;
document.getElementById('sortSelect').onchange = renderTasks;

});
</script>
</body>
</html>











